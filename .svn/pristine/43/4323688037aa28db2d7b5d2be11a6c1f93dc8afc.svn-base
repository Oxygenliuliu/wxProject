(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/uni-order/uniOrder"],{2036:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(a("4795")),r=s(a("f9ff")),i=s(a("6748"));function s(t){return t&&t.__esModule?t:{default:t}}function o(t,e,a,n,r,i,s){try{var o=t[i](s),u=o.value}catch(c){return void a(c)}o.done?e(u):Promise.resolve(u).then(n,r)}function u(t){return function(){var e=this,a=arguments;return new Promise((function(n,r){var i=t.apply(e,a);function s(t){o(i,n,r,s,u,"next",t)}function u(t){o(i,n,r,s,u,"throw",t)}s(void 0)}))}}var c={components:{},props:{scrollHeight:{type:[Number,String],default:function(){return 0}},orderQuerry:{type:Object,default:function(){return{key:!1}}},maskTop:{type:String,default:function(){return""}},fparams:{type:Object,default:function(){return{}}}},data:function(){return{tabBars:[{id:0,name:"全部",isTrue:!0},{id:1,name:"已结清",isTrue:!1},{id:2,name:"未结清",isTrue:!1}],dailyList:[],tabIndex:0,orderList:{allData:[],clear:[],notClear:[]},newsList:[],pageLarge:{nowIndexA:0,nowIndexB:0,nowIndexC:0},pageMaxSize:{pageA:-1,pageB:-1,pageC:-1},nowInfo:{nowIndex:0,maxSize:-1},allCheck:!1,orderNums:0,zMask:!1,prepay_id:"",pageSettlement:0,chooseAll:!1,chooseAllIsShow:!1,temporaryData:{order_id:"",order_code:""},isPay:!1,swiperQuery:!1}},methods:{previewImage:function(e,a){var n=[];e.forEach((function(t){n.push(t.img)})),console.log(n,a,66),t.previewImage({urls:n,current:a,indicator:"number"})},defaultImg:function(t,e){this.dailyList.some((function(a,n){var r=!1;if(n==t)return r=a.child.some((function(t,a){if(a==e)return t.img="http://122.114.123.189/l_img/unExist.png",!0})),r})),console.log(t,e)},choose:function(){var t=this;this.chooseAll=!this.chooseAll,this.dailyList.forEach((function(e){e.isTrue=t.chooseAll}))},displayMore:function(t){var e=this;this.dailyList.some((function(a,n){if(a.BILL_ID==t)return a.isShow=!a.isShow,e.$set(e.dailyList,n,a),!0}))},refresh:function(){var e=this;return u(n.default.mark((function a(){var r;return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!(e.nowInfo.maxSize>=e.nowInfo.nowIndex||-1==e.nowInfo.maxSize)){a.next=8;break}return e.addPageInfo(),a.next=4,e.wrquest(e.params);case 4:r=a.sent,e.setDisplayData(r),a.next=10;break;case 8:return t.showToast({title:"到底了",icon:"none"}),a.abrupt("return");case 10:case"end":return a.stop()}}),a)})))()},changeCheckStatu:function(t){this.dailyList=this.dailyList.map((function(e){return e.BILL_CODE==t&&(e.isTrue=!e.isTrue),e}))},setDisplayData:function(t){var e=this.contactDoubleArr(t);switch(this.dailyList=e,this.tabIndex){case 0:this.orderList.allData=e;break;case 1:this.orderList.clear=e;break;case 2:this.orderList.notClear=e;break;default:break}},addPageInfo:function(){switch(this.tabIndex){case 0:this.nowInfo.nowIndex=this.pageLarge.nowIndexA=this.pageLarge.nowIndexA+1,this.nowInfo.maxSize=this.pageMaxSize.pageA;break;case 1:this.nowInfo.nowIndex=this.pageLarge.nowIndexB=this.pageLarge.nowIndexB+1,this.nowInfo.maxSize=this.pageMaxSize.pageB;break;case 2:this.nowInfo.nowIndex=this.pageLarge.nowIndexC=this.pageLarge.nowIndexC+1,this.nowInfo.maxSize=this.pageMaxSize.pageC;break;default:break}},setPageInfo:function(){switch(this.tabIndex){case 0:this.nowInfo.nowIndex=this.pageLarge.nowIndexA,this.nowInfo.maxSize=this.pageMaxSize.pageA;break;case 1:this.nowInfo.nowIndex=this.pageLarge.nowIndexB,this.nowInfo.maxSize=this.pageMaxSize.pageB;break;case 2:this.nowInfo.nowIndex=this.pageLarge.nowIndexC,this.nowInfo.maxSize=this.pageMaxSize.pageC;break;default:break}},setMaxPage:function(t){switch(this.tabIndex){case 0:this.nowInfo.maxSize=this.pageMaxSize.pageA=parseInt(t/8);break;case 1:this.nowInfo.maxSize=this.pageMaxSize.pageB=parseInt(t/8);break;case 2:this.nowInfo.maxSize=this.pageMaxSize.pageC=parseInt(t/8);break;default:break}},someInit:function(t){for(var e in this.pageLarge={nowIndexA:0,nowIndexB:0,nowIndexC:0},this.pageMaxSize={pageA:-1,pageB:-1,pageC:-1},this.nowInfo={nowIndex:0,maxSize:0},0==this.pageSettlement&&(this.params.Status="2"),this.params)this.params[e]=this.fparams[e];var a=t||0;this.changeType(a),this.tabIndex=a,this.dailyList=[],this.orderList.allData=this.orderList.clear=this.orderList.notClear=[]},changeType:function(t){2==this.tabIndex?this.$emit("changeScrollHeight",{type:!0,height:70}):(this.$emit("changeScrollHeight",{type:!1,height:70}),this.chooseAll=!1),this.tabBars.forEach((function(e){e.isTrue=!1,e.id==t&&(e.isTrue=!0)}))},ontabtap:function(t){var e=parseInt(t.target.dataset.current||t.currentTarget.dataset.current);this.tabIndex=e},ontabchange:function(t){var e=parseInt(t.target.current||t.detail.current);this.tabIndex=e,this.params.Status=e,this.setPageInfo(),this.changeType(e),this.setOrderList(e,this.params)},changeScreen:function(t){var e=t.data1,a=t.data2;this.someInit(),0!=e.length&&this.packageData1(e),0!=a.length&&this.packageData2(a),this.queryData()},packageData1:function(t){var e=this;t.forEach((function(t){if(102==t.id){e.params.BEGINDATE=t.times.statrTime;var a=t.times.endTime,n=[];n=a.split("-"),n[2]=parseInt(n[2])+1,e.params.ENDDATE=n.join("-")}}))},wrquest:function(){var e=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.params;if(!this.swiperQuery)return t.showLoading({title:"加载中..."}),new Promise((function(n,r){t.request({url:e.transitUrl+"/transit_server",method:"POST",data:{interface_add:"http://"+e.url+":"+e.port+"/public/query",token:e.token,params:JSON.stringify(a)},success:function(a){0==a.data.status?(e.setMaxPage(a.data.total),n(a.data.data)):r(t.showToast({title:"异常",icon:"none"}))},fail:function(e){t.showToast({title:"网络异常",icon:"none"})},complete:function(a){t.hideLoading(),e.swiperQuery=!1}})}))},queryData:function(){var t=arguments,e=this;return u(n.default.mark((function a(){var r,i;return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=t.length>0&&void 0!==t[0]?t[0]:e.params,a.next=3,e.wrquest(r);case 3:i=a.sent,e.dailyList=e.createDoubleArr(i),e.orderList.allData=e.dailyList,e.appendCheckBox(),console.log(e.dailyList,6666);case 8:case"end":return a.stop()}}),a)})))()},contactDoubleArr:function(t){var e=this.createDoubleArr(t);e.forEach((function(t){t.child.length}));var a=this.dailyList;return a.forEach((function(t){t.child.length})),e.forEach((function(t,e){var n=a.some((function(e,a){if(t.BILL_ID==e.BILL_ID)return e.child=e.child.concat(t.child),!0}));n||a.push(t)})),a.forEach((function(t){t.child.length})),a},createDoubleArr:function(t){var e=this,a=[];return t.filter((function(t){var e={};e["BILL_CODE"]=t.BILL_CODE,e["BILL_DATE_STR"]=t.BILL_DATE_STR,e["BILL_ID"]=t.BILL_ID,e["BILL_LEFTMONEY"]=t.BILL_LEFTMONEY,e["BILL_PAIDMONEY"]=Math.abs(Number(t.BILL_TOTALMONEY))-Math.abs(Number(t.BILL_LEFTMONEY)),e["child"]=[],a.push(e)})),a=a.filter((function(t,e,a){return a.findIndex((function(e){return e.BILL_CODE==t.BILL_CODE}))===e})),a.forEach((function(a,n){t.forEach((function(t,n){var r=!1,i={};a.BILL_ID==t.BILL_ID&&(r=!0,i["BILLDETAIL_GOODSNAME"]=t.BILLDETAIL_GOODSNAME,i["BILL_LEFTMONEY"]=t.BILL_LEFTMONEY,i["BILLDETAIL_W"]=t.BILLDETAIL_W,i["BILLDETAIL_PRICE"]=t.BILLDETAIL_PRICE,i["BILLDETAIL_H"]=t.BILLDETAIL_H,i["BILLDETAIL_TOTALQTY"]=t.BILLDETAIL_QTY,i["BILLDETAIL_TOTALMONEY"]=t.BILLDETAIL_TOTALMONEY,i["img"]=e.wpublic.getImgUrl(t.BILLDETAIL_ID)),r&&a.child.push(i)}))})),a},returnAppendCheckBox:function(t){return t.forEach((function(t,e){t.isTrue=!1,t.isShow=!0})),t},appendCheckBox:function(){var t=this;0!=this.dailyList.length&&this.dailyList.forEach((function(e,a){t.$set(t.dailyList[a],"isTrue",!1),t.$set(t.dailyList[a],"isShow",!1)}))},pullRefresh:function(){this.params.PAGE_INDEX=0,this.queryData()},jqueyForCustomer:function(){var t=this;this.pageSettlement=1,[1,2,3].forEach((function(e){t.newsList.push(e)})),this.chooseAllIsShow=!0,this.nowInfo.nowIndex=0,this.someInit(0),this.queryData()},scanJquery:function(){this.swiperQuery=!0,this.someInit(0),this.queryData()},package:function(){var t=[];this.dailyList.forEach((function(e){e.isTrue&&e.child.some((function(a,n){var r={id:0};return r.LpTotal=a.BILL_LEFTMONEY,r.total=a.BILL_LEFTMONEY,r.refbillid=e.BILL_ID,t.push(r),!0}))}));var e={MODE:1,order:{id:0,type:2,Date:this.wpublic.getDay(0),partnerid:this.partnerid,paymenttypeid:258,paymoney:this.sales,total:this.sales,remark:"微信小程序临时收款"},OrderDetail:t};return e},payStatus:function(){var t=!1;return t=this.dailyList.some((function(t){if(t.isTrue)return!0})),t},complete:function(e){var a=this;return new Promise((function(n,i){t.request({url:a.transitUrl+"/transit_server",method:"POST",data:{interface_add:"http://"+a.url+":"+a.port+"/public/common",token:a.token,params:JSON.stringify(e)},success:function(e){var a=r.default.loginJudge(e.data.status);if(0==a)return!1;0==e.data.status?n(e.data):i(t.showToast({title:"订单修改失败"+e.data.message,icon:"none"}))},fail:function(e){i(t.showToast({title:"网络繁忙,稍后重试"+e.message,icon:"none"}))}})}))},pay:function(){var e=this;return u(n.default.mark((function a(){var r,i;return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(e.payStatus()){a.next=3;break}return t.showToast({title:"请选择单子",icon:"none"}),a.abrupt("return");case 3:if(""==e.partnerid){a.next=12;break}return r=e.package(),console.log(r),a.next=8,e.complete(r).catch((function(){return"wrong"}));case 8:i=a.sent,"wrong"!=i?0==i.status?(e.temporaryData.order_id=i.order_id,e.temporaryData.order_code=i.order_code_long,e.taskPay(e.temporaryData.order_code)):t.showToast({title:i.message,icon:"none"}):t.showToast({title:"异常",icon:"none"}),a.next=13;break;case 12:t.showToast({title:"客户ID获取异常",icon:"none"});case 13:case"end":return a.stop()}}),a)})))()},deleteOrder:function(e){var a=this;t.showLoading({title:"加载中..."}),t.request({url:this.transitUrl+"/transit_server",method:"POST",data:{interface_add:"http://"+this.url+":"+this.port+"/public/common",token:this.token,params:JSON.stringify(e)},success:function(n){var i=r.default.loginJudge(n.data.status);if(0==i)return t.showToast({title:"验证码过期请重新登录",icon:"none"}),!1;if(0==n.data.status&&0==n.data.FailureCount)1==e.type?(t.showToast({title:"登账成功",icon:"success"}),setTimeout((function(){a.pullRefresh()}),500)):-1==e.type&&(a.isPay&&(a.isPay=!1,a.taskBackMoney(a.temporaryData.order_code)),t.showToast({title:"删除临时账单成功",icon:"success"}));else{a.isPay&&(a.isPay=!1,a.taskBackMoney(a.temporaryData.order_code));try{t.showToast({title:n.data.FailureIdList[0].ERROR})}catch(s){}}},fail:function(){a.isPay&&(a.isPay=!1,a.taskBackMoney(a.temporaryData.order_code))},complete:function(){t.hideLoading()}})},beforeWXpay:function(e,a){t.showLoading({title:"发起支付中..."});var n=JSON.parse(t.getStorageSync("userInfo")),r=t.getStorageSync("personName"),s=t.getStorageSync("token"),o={trade_no:a,customer_id:n.personId,customer_name:r,erp_ip:this.url+":"+this.port,receipt_id:this.temporaryData.order_id,token:s,total_fee:"0.01"};return new Promise((function(a,n){wx.login({success:function(r){var s=r.code;t.request({url:e+"/unifiedorder",method:"POST",data:{token:(0,i.default)(s+"FYDL"),code:s,params:JSON.stringify(o)},success:function(t){a(t)},fail:function(e){t.showToast({title:"请求失败错误码201",icon:"none"}),n()}})}})}))},taskPay:function(t){var e=this;return u(n.default.mark((function a(){var r;return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,e.beforeWXpay(e.payUrl,t).catch((function(){return{state:500}}));case 2:r=a.sent,200==r.statusCode&&200==r.data.status?e.WXpay(r.data):e.taskPayWrong(r);case 4:case"end":return a.stop()}}),a)})))()},taskPayWrong:function(e){t.showToast({title:"出错"+e.data.RETURN_MSG,icon:"none"})},taskBackMoney:function(e){var a=this;return u(n.default.mark((function r(){var i;return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,a.backMoney(a.payUrl,e).catch((function(){return{state:500}}));case 2:i=n.sent,200==i.statusCode&&200==i.data.status?t.showToast({title:"退款成功",icon:"success"}):t.showToast({title:"自动退款失败请联系管理员",icon:"success"});case 4:case"end":return n.stop()}}),r)})))()},backMoney:function(e,a){return t.showLoading({title:"退款中..."}),new Promise((function(n,r){wx.login({success:function(i){var s=i.code;t.request({url:e+"/refund",method:"POST",data:{total_fee:"0.01",code:s,out_trade_no:a},success:function(t){n(t)},fail:function(t){r()},complete:function(){t.hideLoading()}})}})}))},WXpay:function(e){var a=this;t.requestPayment({provider:"wxpay",timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign,success:function(e){e.errMsg,t.navigateTo({url:"../../pages/order/payresult?order_id="+a.temporaryData.order_code})},fail:function(e){t.showToast({title:"支付已取消",icon:"none"})},complete:function(){t.hideLoading()}})},setOrderList:function(){var t=arguments,e=this;return u(n.default.mark((function a(){var r,i,s,o,u,c;return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:r=t.length>0&&void 0!==t[0]?t[0]:-1,i=t.length>1?t[1]:void 0,a.t0=r,a.next=-1===a.t0?5:0===a.t0?11:1===a.t0?21:2===a.t0?31:41;break;case 5:return a.next=7,e.wrquest(i);case 7:return s=a.sent,e.orderList.allData=e.createDoubleArr(s),e.dailyList=e.orderList.allData,a.abrupt("break",42);case 11:if(0!=e.orderList.allData.length){a.next=19;break}return a.next=14,e.wrquest(i);case 14:o=a.sent,e.orderList.allData=e.createDoubleArr(o),e.dailyList=e.orderList.allData,a.next=20;break;case 19:e.dailyList=e.orderList.allData;case 20:return a.abrupt("break",42);case 21:if(0!=e.orderList.clear.length){a.next=29;break}return a.next=24,e.wrquest(i);case 24:u=a.sent,e.orderList.clear=e.createDoubleArr(u),e.dailyList=e.orderList.clear,a.next=30;break;case 29:e.dailyList=e.orderList.clear;case 30:return a.abrupt("break",42);case 31:if(0!=e.orderList.notClear.length){a.next=39;break}return a.next=34,e.wrquest(i);case 34:c=a.sent,e.orderList.notClear=e.createDoubleArr(c),e.dailyList=e.orderList.notClear,a.next=40;break;case 39:e.dailyList=e.orderList.notClear;case 40:return a.abrupt("break",42);case 41:return a.abrupt("break",42);case 42:e.appendCheckBox();case 43:case"end":return a.stop()}}),a)})))()}},computed:{payUrl:{set:function(){return 0},get:function(){return this.$store.state.payUrl}},transitUrl:{set:function(){return 0},get:function(){return this.$store.state.transitUrl}},url:{get:function(){return this.$store.state.loginParams.url},set:function(){return""}},port:{get:function(){return this.$store.state.loginParams.port},set:function(){return 7798}},dbname:{get:function(){return this.$store.state.loginParams.dbname},set:function(){return""}},token:{get:function(){return this.$store.state.token},set:function(){return""}},params:{set:function(){return{}},get:function(){var t=this.wpublic.deepClone(this.fparams);return t}},num:{set:function(){return 0},get:function(){if(0==this.pageSettlement)return this.dailyList.length;var t=0;return this.dailyList.forEach((function(e){e.isTrue&&t++})),t}},partnerid:{set:function(){return 0},get:function(){return this.$store.state.loginParams.personId}},sales:{set:function(){return 0},get:function(){var t=this,e=0;return this.dailyList.forEach((function(a){0==t.pageSettlement?e+=Math.abs(parseFloat(a.BILL_LEFTMONEY)):a.isTrue&&(e+=Math.abs(parseFloat(a.BILL_LEFTMONEY)))})),e}}}};e.default=c}).call(this,a("543d")["default"])},"3a9f":function(t,e,a){"use strict";a.r(e);var n=a("2036"),r=a.n(n);for(var i in n)"default"!==i&&function(t){a.d(e,t,(function(){return n[t]}))}(i);e["default"]=r.a},"3ad9":function(t,e,a){},"58e8":function(t,e,a){"use strict";var n,r=function(){var t=this,e=t.$createElement,a=(t._self._c,t.__map(t.newsList,(function(e,a){var n=t.__map(t.dailyList,(function(e,a){var n=t._f("priceFormat")(e.BILL_PAIDMONEY,2,"￥",!0),r=t._f("priceFormat")(e.BILL_LEFTMONEY,2,"￥",!0),i=t.__map(e.child,(function(e,a){var n=t._f("priceFormat")(e.BILLDETAIL_PRICE,2,"￥",!0),r=t._f("priceFormat")(e.BILLDETAIL_TOTALMONEY,2,"￥",!0);return{$orig:t.__get_orig(e),f2:n,f3:r}}));return{$orig:t.__get_orig(e),f0:n,f1:r,l0:i}}));return{$orig:t.__get_orig(e),l1:n}}))),n=t._f("priceFormat")(t.sales,2,"￥",!0);t.$mp.data=Object.assign({},{$root:{l2:a,f4:n}})},i=[];a.d(e,"b",(function(){return r})),a.d(e,"c",(function(){return i})),a.d(e,"a",(function(){return n}))},"8e5b":function(t,e,a){"use strict";a.r(e);var n=a("58e8"),r=a("3a9f");for(var i in r)"default"!==i&&function(t){a.d(e,t,(function(){return r[t]}))}(i);a("d427");var s,o=a("f0c5"),u=Object(o["a"])(r["default"],n["b"],n["c"],!1,null,"29961dca",null,!1,n["a"],s);e["default"]=u.exports},d427:function(t,e,a){"use strict";var n=a("3ad9"),r=a.n(n);r.a}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/uni-order/uniOrder-create-component',
    {
        'components/uni-order/uniOrder-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("8e5b"))
        })
    },
    [['components/uni-order/uniOrder-create-component']]
]);
